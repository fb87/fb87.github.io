'use strict';

var app = angular.module("Blog", []);

app.controller("ngPostFilterController", ["$scope", "$http", function ($scope, $http) {
    $scope.all_titles = [];
    $scope.is_en = false;

    $scope.toogle_language = function() {
        $scope.is_en = !$scope.is_en;

        $http.get('/api/v1.0/titles.'+ ($scope.is_en?'en':'vi') + '.json').then(function (response) {
            $scope.all_titles = response.data;
        });
    }
    
    $scope.toogle_language();
}]);

app.controller("ngCommentController", ["$scope", "$http", function ($scope, $http) {
    $scope.comments = [];
    $scope.warn_message = "";
    $scope.search_tokens = "";

    $scope.find_comment = function (id) {
        var issue_base_uri = 'fb87/fb87.github.io/issues/' + id;
        var issue_base_url = 'https://github.com/' + issue_base_uri;
        var comment_query_url = 'https://api.github.com/repos/' + issue_base_uri + '/comments';

        // FIXME: github has some limitation for requesting data (60 requests/hour)
        //        better to cache the result down to local storage instead to avoid
        //        reaching that limit.
        $http.get(comment_query_url).then(function (response) {
            $scope.comments = response.data;
            $scope.warn_message = $scope.comments.length + " comment(s) found";
            $scope.channel = issue_base_url;
        }, function (_) {
            $scope.warn_message = "No discussion found";
        });
    };
}]);
