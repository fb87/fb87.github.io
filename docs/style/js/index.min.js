'use strict';

var app = angular.module("finder", []);

app.controller("PostFinder", [ "$scope", "$http", function($scope, $http) {
    $scope.all_titles = [];
    $http.get('/api/v1.0/titles.json').then(function(response) {
        $scope.all_titles = response.data;
    });
}]);

app.controller("Discussion", [ "$scope", "$http", function($scope, $http) {
    $scope.comments = [];
    $scope.discussion = undefined;
    $scope.warn_message = "";

    $scope.find_comment = function(id) {
        console.log("- find", id);
        $http.get('https://api.github.com/repos/s1ng0c/s1ng0c.github.io/issues').then(function(response) {
            for (var i in response.data) {
                var issue = response.data[i];
                if (issue.title === id) {
                    $scope.discussion = issue.html_url;
                    $http.get('https://api.github.com/repos/s1ng0c/s1ng0c.github.io/issues/' + issue.number + '/comments').then(function(response) {
                        $scope.comments = response.data;
                    });
                    break;
                }
            }
            if (response.data == 0) $scope.warn_message = "No disccussion found";
        });
    };
}]);