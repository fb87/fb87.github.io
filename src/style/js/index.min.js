'use strict';

var app = angular.module("Blog", []);

app.controller("ngPostFilterController", ["$scope", "$http", function ($scope, $http) {
    $scope.all_titles = [];
    $http.get('/api/v1.0/titles.json').then(function (response) {
        $scope.all_titles = response.data;
    });
}]);

app.controller("ngCommentController", ["$scope", "$http", function ($scope, $http) {
    $scope.comments = [];
    $scope.warn_message = "";

    $scope.find_comment = function (id) {
        var user_id = "s1ng0c";
        var issue_base = 'github.com/repos/' + user_id + '/'+ user_id + '.github.io/issues/' + id;
        var comment_url = 'https://api.' + issue_base + '/comments';

        // FIXME: github has some limitation for requesting data (60 requests/hour)
        //        better to cache the result down to local storage instead to avoid
        //        reaching that limit.
        $http.get(comment_url).then(function (response) {
            $scope.comments = response.data;
            $scope.warn_message = $scope.comments.length + " comment(s) found";
            $scope.channel = 'https://' + issue_base;
        }, function (_) {
            $scope.warn_message = "No discussion found";
        });
    };
}]);